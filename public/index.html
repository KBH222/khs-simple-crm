<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="KHS CRM">
  <meta name="theme-color" content="#3B82F6">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- iOS Icons -->
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png">
  <link rel="apple-touch-icon" sizes="128x128" href="/icons/icon-128x128.png">
  
  <!-- Fallback for older browsers -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="KHS CRM">
  <link rel="icon" sizes="192x192" href="/icons/icon-192x192.png">
  <link rel="icon" sizes="128x128" href="/icons/icon-128x128.png">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>KHS CRM</title>
  <link rel="stylesheet" href="style.css?v=20250922000002&t=1737523200000">
  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèóÔ∏è</text></svg>">
</head>
<body>
  <!-- Offline Banner -->
  <div id="offlineBanner" class="offline-banner">
    üî¥ You're offline - Changes will sync when reconnected
  </div>
  
  <!-- Main App Screen -->
  <div id="appScreen" class="screen">
    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
          <h1 class="app-title">
            <div class="logo-placeholder">K</div>
            <span>KHS CRM</span>
          </h1>
          <div class="header-user">
            <span id="connection-status" class="connection-status" style="margin-right: 10px;"></span>
            <span id="envBadge" class="env-badge" title="Active API target"></span>
            <span id="userName">Administrator</span>
          </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="app-main">
      <!-- Dashboard -->
      <div id="dashboard" class="page active">
        <div class="page-container">
          <!-- Date and Time -->
          <div class="dashboard-header">
            <div class="current-date" id="currentDate"></div>
            <div class="current-time" id="currentTime"></div>
          </div>

          <!-- Quick Access Cards -->
          <h2 class="section-title">Quick Access</h2>
          <div class="nav-grid">
            <div class="nav-card" data-page="customers" onclick="showPage('customers')">
              <div class="nav-card-header" style="background-color: #3B82F6;"></div>
              <div class="nav-card-content">
                <div class="nav-card-icon">üë•</div>
                <div class="nav-card-info">
                  <h3>Customers</h3>
                  <p>View and manage customer information</p>
                </div>
                <div class="nav-card-arrow">‚Üí</div>
              </div>
            </div>

            <div class="nav-card" data-page="settings" onclick="showPage('settings')">
              <div class="nav-card-header" style="background-color: #10B981;"></div>
              <div class="nav-card-content">
                <div class="nav-card-icon">‚öôÔ∏è</div>
                <div class="nav-card-info">
                  <h3>Settings</h3>
                  <p>App settings and data backup</p>
                </div>
                <div class="nav-card-arrow">‚Üí</div>
              </div>
            </div>

            <div class="nav-card" data-page="schedule" onclick="showPage('schedule')">
              <div class="nav-card-header" style="background-color: #EF4444;"></div>
              <div class="nav-card-content">
                <div class="nav-card-icon">üìã</div>
                <div class="nav-card-info">
                  <h3>Schedule</h3>
                  <p>View and manage work schedule</p>
                </div>
                <div class="nav-card-arrow">‚Üí</div>
              </div>
            </div>

            <div class="nav-card" data-page="workers" onclick="showPage('workers')">
              <div class="nav-card-header" style="background-color: #F59E0B;"></div>
              <div class="nav-card-content">
                <div class="nav-card-icon">üë∑</div>
                <div class="nav-card-info">
                  <h3>Workers</h3>
                  <p>Manage team assignments</p>
                </div>
                <div class="nav-card-arrow">‚Üí</div>
              </div>
            </div>

            <div class="nav-card" data-page="materials" onclick="showPage('materials')">
              <div class="nav-card-header" style="background-color: #8B5CF6;"></div>
              <div class="nav-card-content">
                <div class="nav-card-icon">üìã</div>
                <div class="nav-card-info">
                  <h3>Master Lists</h3>
                  <p>All tasks and tools from all jobs</p>
                </div>
                <div class="nav-card-arrow">‚Üí</div>
              </div>
            </div>

            <div class="nav-card" data-page="profile" onclick="showPage('profile')">
              <div class="nav-card-header" style="background-color: #6B7280;"></div>
              <div class="nav-card-content">
                <div class="nav-card-icon">‚öôÔ∏è</div>
                <div class="nav-card-info">
                  <h3>Profile</h3>
                  <p>User account and preferences</p>
                </div>
                <div class="nav-card-arrow">‚Üí</div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- Customers Page -->
      <div id="customers" class="page">
        <div class="page-container">
          <div class="page-header">
            <button class="back-btn" data-target="dashboard">‚Üê Dashboard</button>
            <h2>Customers</h2>
            <button class="add-btn" id="addCustomerBtn">+ Add Customer</button>
          </div>

          <div class="filters">
            <div class="filter-tabs">
              <button class="filter-tab active" data-type="">All</button>
              <button class="filter-tab" data-type="CURRENT">Clients</button>
              <button class="filter-tab" data-type="LEADS">Leads</button>
            </div>
          </div>

          <div class="search-bar">
            <input type="text" id="customerSearch" placeholder="Search customers...">
          </div>

          <div id="customersList" class="customers-list">
            <!-- Customers will be loaded here -->
          </div>
        </div>
      </div>

      <!-- Add/Edit Customer Modal -->
      <div id="customerModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="customerModalTitle">Add Customer</h3>
            <button class="close-btn">&times;</button>
          </div>
          <form id="customerForm">
            <!-- Reference and Type on same line -->
            <div class="form-row" style="display: flex; gap: 16px; align-items: flex-start;">
              <div class="form-group" style="flex: 1.4;">
                <label>Reference</label>
                <div class="reference-options" style="display: flex; gap: 6px; margin-top: 8px; flex-wrap: nowrap;">
                  <label style="display: flex; align-items: center; cursor: pointer; padding: 6px 8px; border: 1px solid #D1D5DB; border-radius: 4px; font-size: 13px;">
                    <input type="radio" name="customerReference" value="Yelp" style="margin-right: 4px;">
                    Yelp
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer; padding: 6px 8px; border: 1px solid #D1D5DB; border-radius: 4px; font-size: 13px;">
                    <input type="radio" name="customerReference" value="Referral" style="margin-right: 4px;">
                    Ref
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer; padding: 6px 8px; border: 1px solid #D1D5DB; border-radius: 4px; font-size: 13px;">
                    <input type="radio" name="customerReference" value="HOD" style="margin-right: 4px;">
                    HOD
                  </label>
                </div>
              </div>
              
              <div class="form-group" style="flex: 1;">
                <label>Type</label>
                <div class="type-options" style="display: flex; gap: 6px; margin-top: 8px;">
                  <label style="display: flex; align-items: center; cursor: pointer; padding: 6px 10px; border: 1px solid #D1D5DB; border-radius: 4px; font-size: 13px;">
                    <input type="radio" name="customerType" value="CURRENT" style="margin-right: 4px;" checked>
                    Client
                  </label>
                  <label style="display: flex; align-items: center; cursor: pointer; padding: 6px 10px; border: 1px solid #D1D5DB; border-radius: 4px; font-size: 13px;">
                    <input type="radio" name="customerType" value="LEADS" style="margin-right: 4px;">
                    Lead
                  </label>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="customerName">Name *</label>
              <input type="text" id="customerName" required>
            </div>
            <div class="form-group">
              <label for="customerPhone">Phone</label>
              <input type="tel" id="customerPhone" placeholder="(808) 387-6129" maxlength="14">
            </div>
            <div class="form-group">
              <label for="customerEmail">Email</label>
              <input type="email" id="customerEmail">
            </div>
            <div class="form-group">
              <label for="customerStreet">Street Address *</label>
              <input type="text" id="customerStreet" placeholder="123 Main Street" required>
            </div>
            <div class="form-row" style="display: flex; gap: 10px;">
              <div class="form-group" style="flex: 2;">
                <label for="customerCity">City *</label>
                <input type="text" id="customerCity" placeholder="Honolulu" required>
              </div>
              <div class="form-group" style="flex: 1;">
                <label for="customerState">State</label>
                <input type="text" id="customerState" value="HI" readonly style="background-color: #f9fafb;">
              </div>
              <div class="form-group" style="flex: 1;">
                <label for="customerZip">ZIP Code *</label>
                <input type="text" id="customerZip" placeholder="96815" maxlength="5" pattern="[0-9]{5}" required>
              </div>
            </div>
            <div class="form-group">
              <label for="customerNotes">Notes</label>
              <textarea id="customerNotes"></textarea>
            </div>
            <div class="modal-actions">
              <button type="button" class="cancel-btn">Cancel</button>
              <button type="submit" class="save-btn">Save Customer</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Add/Edit Job Modal -->
      <div id="jobModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="jobModalTitle">Create Job</h3>
            <button class="close-btn">&times;</button>
          </div>
          <form id="jobForm">
            <div class="form-group">
              <label for="jobCustomer">Customer *</label>
              <input type="text" id="jobCustomer" readonly style="background-color: #f9fafb;">
            </div>
            <div class="form-group">
              <label>Job Type *</label>
              <div class="job-types" style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 8px;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                  <input type="radio" name="jobType" value="Kitchen" required style="margin-right: 6px;">
                  Kitchen
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                  <input type="radio" name="jobType" value="Bathroom" required style="margin-right: 6px;">
                  Bathroom
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                  <input type="radio" name="jobType" value="Flooring" required style="margin-right: 6px;">
                  Flooring
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                  <input type="radio" name="jobType" value="Decking" required style="margin-right: 6px;">
                  Decking
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                  <input type="radio" name="jobType" value="Drywall" required style="margin-right: 6px;">
                  Drywall
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                  <input type="radio" name="jobType" value="Various" required style="margin-right: 6px;">
                  Various
                </label>
              </div>
            </div>
            <div class="form-group">
              <label for="jobDescription">Description</label>
              <textarea id="jobDescription" placeholder="Detailed description of the job..."></textarea>
            </div>
            <div class="form-group">
              <label for="jobNotes">Notes</label>
              <textarea id="jobNotes" placeholder="Additional notes or requirements..."></textarea>
            </div>
            <div class="modal-actions">
              <button type="button" class="cancel-btn">Cancel</button>
              <button type="submit" class="save-btn">Create Job</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Job Details Modal -->
      <div id="jobDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh;">
          <div class="modal-header">
            <h3 id="jobDetailsTitle">Job Details</h3>
            <button class="close-btn">&times;</button>
          </div>
          
          <!-- Tab Navigation -->
          <div class="job-tabs" style="display: flex; border-bottom: 1px solid #E5E7EB; background: #F9FAFB;">
            <button class="job-tab active" data-tab="info" onclick="switchJobTab('info')">Info</button>
            <button class="job-tab" data-tab="tasks" onclick="switchJobTab('tasks')">Task</button>
            <button class="job-tab" data-tab="tools" onclick="switchJobTab('tools')">Tool</button>
            <button class="job-tab" data-tab="materials" onclick="switchJobTab('materials')">MTLS</button>
            <button class="job-tab" data-tab="pics" onclick="switchJobTab('pics')">Pic</button>
            <button class="job-tab" data-tab="plans" onclick="switchJobTab('plans')">Plan</button>
            <button class="job-tab" data-tab="extra" onclick="switchJobTab('extra')">Xtra$</button>
          </div>
          
          <div class="job-tab-content" style="max-height: 60vh; overflow-y: auto; padding: 20px;">
            
            <!-- Info Tab -->
            <div id="jobTab-info" class="job-tab-panel active">
              <div class="form-group" style="margin-bottom: 8px;">
                <div style="display: flex; align-items: baseline; gap: 20px; margin-bottom: 8px;">
                  <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 4px;">Customer</label>
                    <div id="jobDetailCustomer" style="font-weight: 600; color: #111827; font-size: 16px;"></div>
                  </div>
                  <div style="flex: 1; text-align: center;">
                    <label style="display: block; margin-bottom: 4px;">Job Type</label>
                    <div id="jobDetailType" style="font-weight: 600; color: #3B82F6; font-size: 16px;"></div>
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <label for="projectScope">Project Scope</label>
                <textarea id="projectScope" placeholder="Enter the overall scope and details of this project..." style="width: 100%; height: 120px; padding: 10px; border: 1px solid #D1D5DB; border-radius: 6px; font-size: 14px; resize: vertical; font-family: inherit; line-height: 1.4;"></textarea>
              </div>
              
              <div class="form-group" id="jobDetailDescriptionGroup">
                <label>Description</label>
                <div id="jobDetailDescription" style="color: #374151; white-space: pre-wrap;"></div>
              </div>
              
              <div class="form-group" id="jobDetailNotesGroup">
                <label>Notes</label>
                <div id="jobDetailNotes" style="color: #374151; white-space: pre-wrap;"></div>
              </div>
            </div>
            
            <!-- Task List Tab -->
            <div id="jobTab-tasks" class="job-tab-panel">
              <div class="task-header" style="margin-bottom: 20px;">
                <h4 style="margin: 0; color: #111827;">Tasks</h4>
              </div>
              <div id="tasksList" class="tasks-list">
                <p style="color: #6B7280; text-align: center; padding: 20px;">Loading tasks...</p>
              </div>
            </div>
            
            <!-- Tool List Tab -->
            <div id="jobTab-tools" class="job-tab-panel">
              <div class="tool-header" style="margin-bottom: 20px;">
                <h4 style="margin: 0; color: #111827;">Tools</h4>
              </div>
              <div id="toolsList" class="tools-list">
                <p style="color: #6B7280; text-align: center; padding: 20px;">Loading tools...</p>
              </div>
            </div>
            
            <!-- Materials List Tab -->
            <div id="jobTab-materials" class="job-tab-panel">
              <div class="materials-header" style="margin-bottom: 20px;">
                <h4 style="margin: 0; color: #111827;">Materials</h4>
              </div>
              <div id="materialsList" class="materials-list">
                <p style="color: #6B7280; text-align: center; padding: 20px;">Loading materials...</p>
              </div>
            </div>
            
            <!-- Pics Tab -->
            <div id="jobTab-pics" class="job-tab-panel">
              <div class="file-upload-section">
                <h4 style="margin: 0 0 15px 0; color: #111827;">Pictures</h4>
                <div class="file-drop-zone" id="picsDropZone" style="border: 2px dashed #D1D5DB; border-radius: 8px; padding: 40px; text-align: center; background: #F9FAFB; cursor: pointer; transition: border-color 0.2s;">
                  <div style="color: #6B7280;">
                    <div style="font-size: 48px; margin-bottom: 10px;">üì∏</div>
                    <p>Drop image files here or <strong style="color: #3B82F6;">click to browse</strong></p>
                    <p style="font-size: 12px;">Supported: JPG, PNG, GIF, HEIF, HEIC (Max 10MB each)</p>
                  </div>
                  <input type="file" id="picsFileInput" multiple accept="image/*,.heif,.HEIF,.heic,.HEIC" style="display: none;">
                </div>
                <div id="picsList" class="files-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-top: 20px;">
                  <!-- Pictures will be loaded here -->
                </div>
              </div>
            </div>
            
            <!-- Plans Tab -->
            <div id="jobTab-plans" class="job-tab-panel">
              <div class="file-upload-section">
                <h4 style="margin: 0 0 15px 0; color: #111827;">Plans & Documents</h4>
                <div class="file-drop-zone" id="plansDropZone" style="border: 2px dashed #D1D5DB; border-radius: 8px; padding: 40px; text-align: center; background: #F9FAFB; cursor: pointer; transition: border-color 0.2s;">
                  <div style="color: #6B7280;">
                    <div style="font-size: 48px; margin-bottom: 10px;">üìÑ</div>
                    <p>Drop plan files here or <strong style="color: #3B82F6;">click to browse</strong></p>
                    <p style="font-size: 12px;">Supported: PDF, DWG, JPG, PNG (Max 25MB each)</p>
                  </div>
                  <input type="file" id="plansFileInput" multiple accept=".pdf,.dwg,.jpg,.jpeg,.png" style="display: none;">
                </div>
                <div id="plansList" class="files-list" style="margin-top: 20px;">
                  <!-- Plans will be loaded here -->
                </div>
              </div>
            </div>
            
            <!-- Xtra$ Tab -->
            <div id="jobTab-extra" class="job-tab-panel">
              <div class="extra-costs-section">
                <div class="cost-header" style="margin-bottom: 20px;">
                  <h4 style="margin: 0; color: #111827;">Extra Costs</h4>
                </div>
                <div id="extraCostsList" class="extra-costs-list">
                  <p style="color: #6B7280; text-align: center; padding: 20px;">Loading extra costs...</p>
                </div>
              </div>
            </div>
            
          </div>
          
        </div>
      </div>

      <!-- Other pages (placeholder) -->
      <div id="jobs" class="page">
        <div class="page-container">
          <div class="page-header">
            <button class="back-btn" data-target="dashboard">‚Üê Dashboard</button>
            <h2>Jobs</h2>
          </div>
          <p>Jobs management coming soon...</p>
        </div>
      </div>

      <div id="schedule" class="page">
        <div class="page-container">
          <div class="page-header">
            <button class="back-btn" data-target="dashboard">‚Üê Dashboard</button>
            <h2>Schedule</h2>
            <div class="schedule-view-toggle">
              <button class="toggle-btn active" data-view="calendar" id="calendarViewBtn">
                <span style="margin-right: 4px;">üìÖ</span> Calendar
              </button>
              <button class="toggle-btn" data-view="gantt" id="ganttViewBtn">
                <span style="margin-right: 4px;">üìä</span> Timeline
              </button>
            </div>
            <button class="add-btn" id="addEventBtn">+ Add Event</button>
          </div>
          
          <!-- Calendar View -->
          <div id="calendarView" class="schedule-view active">
            <!-- Calendar Navigation -->
            <div class="calendar-nav">
            <button id="prevMonth" class="nav-btn">‚Äπ</button>
            <div class="calendar-header">
              <h3 id="currentMonth">January 2025</h3>
            </div>
            <button id="nextMonth" class="nav-btn">‚Ä∫</button>
            <button id="todayBtn" class="today-btn">Today</button>
          </div>
          
          <!-- Calendar Grid -->
          <div class="calendar-container">
            <div class="calendar-grid">
              <!-- Day Headers -->
              <div class="calendar-header-row">
                <div class="calendar-day-header">Sun</div>
                <div class="calendar-day-header">Mon</div>
                <div class="calendar-day-header">Tue</div>
                <div class="calendar-day-header">Wed</div>
                <div class="calendar-day-header">Thu</div>
                <div class="calendar-day-header">Fri</div>
                <div class="calendar-day-header">Sat</div>
              </div>
              
              <!-- Calendar Days (generated by JavaScript) -->
              <div id="calendarDays" class="calendar-days"></div>
            </div>
          </div>
          </div>
          
          <!-- Gantt View -->
          <div id="ganttView" class="schedule-view" style="display: none;">
            <div id="ganttChartContainer"></div>
          </div>
        </div>
      </div>
      
      <!-- Add/Edit Event Modal -->
      <div id="eventModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="eventModalTitle">Add Event</h3>
            <button class="close-btn">&times;</button>
          </div>
          <form id="eventForm">
            <div class="form-group">
              <label for="eventTitle">Title *</label>
              <input type="text" id="eventTitle" required>
            </div>
            
            <div class="form-group">
              <label for="eventDescription">Description</label>
              <textarea id="eventDescription" placeholder="Event details..."></textarea>
            </div>
            
            <div class="form-group">
              <label for="eventDate">Date *</label>
              <input type="date" id="eventDate" required>
            </div>
            
            <div class="form-group">
              <div class="time-container">
                <div class="time-group">
                  <label for="eventStartTime">Start Time</label>
                  <input type="time" id="eventStartTime">
                </div>
                <div class="time-group">
                  <label for="eventEndTime">End Time</label>
                  <input type="time" id="eventEndTime">
                </div>
                <div class="checkbox-group">
                  <label>
                    <input type="checkbox" id="eventAllDay"> All Day
                  </label>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label>Event Type</label>
              <div class="event-type-radio" style="display: flex; gap: 20px; margin-top: 8px;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                  <input type="radio" name="eventType" value="business" checked style="margin-right: 6px;">
                  Business
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                  <input type="radio" name="eventType" value="personal" style="margin-right: 6px;">
                  Personal
                </label>
              </div>
            </div>
            
            <div class="form-group" id="customerJobGroup">
              <label for="eventCustomer">Related Customer (Optional)</label>
              <select id="eventCustomer">
                <option value="">Select customer...</option>
              </select>
              
              <label for="eventJob" style="margin-top: 10px;">Related Job (Optional)</label>
              <select id="eventJob">
                <option value="">Select job...</option>
              </select>
            </div>
            
            <div class="modal-actions">
              <button type="button" class="cancel-btn">Cancel</button>
              <button type="submit" class="save-btn">Save Event</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Settings Page -->
      <div id="settings" class="page">
        <div class="page-container">
          <div class="page-header">
            <button class="back-btn" data-target="dashboard">‚Üê Dashboard</button>
            <h2>Settings</h2>
          </div>
          
          <!-- Settings Tabs -->
          <div class="settings-tabs">
            <button class="settings-tab active" data-tab="backup">Backup</button>
            <button class="settings-tab" data-tab="general">General</button>
            <button class="settings-tab" data-tab="textsend">Text Send</button>
            <button class="settings-tab" data-tab="about">About</button>
          </div>
          
          <!-- Backup Tab -->
          <div id="backupTab" class="settings-tab-content active">
            <div class="settings-section">
              <h3>Automatic Data Protection</h3>
              <p class="settings-description">Your data is automatically protected with systematic backups.</p>
              
              <!-- Automatic Backup Status -->
              <div class="backup-section">
              <div class="backup-card" style="border: 2px solid #10B981; background: linear-gradient(135deg, #ECFDF5 0%, #F0FDF4 100%);">
                <div class="backup-card-header">
                  <div class="backup-icon" style="color: #10B981;">üîÑ</div>
                  <div class="backup-info">
                    <h4 style="color: #065F46;">Automatic Backups</h4>
                    <p style="color: #047857;">Database backups run automatically every 24 hours and on server restart</p>
                  </div>
                </div>
                <div style="background: #F0FDF4; padding: 10px; border-radius: 6px; margin-top: 10px;">
                  <div style="font-size: 14px; color: #065F46;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                      <span>‚úÖ</span> <strong>Daily backups:</strong> Every 24 hours
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                      <span>‚úÖ</span> <strong>Startup backups:</strong> On server restart
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <span>‚úÖ</span> <strong>Retention:</strong> Keeps last 10 backups
                    </div>
                  </div>
                </div>
              </div>
              </div>
              
              <!-- Backup History -->
              <div class="backup-section">
                <h4>Recent Backups</h4>
                <div id="backupHistory" class="backup-history">
                  <div class="backup-loading">Loading backup history...</div>
                </div>
              </div>
              
              <!-- Restore Backup -->
              <div class="backup-section">
                <div class="restore-backup-card">
                  <div class="restore-card-header">
                    <div class="restore-icon">üîÑ</div>
                    <div class="restore-info">
                      <h4>Restore from Backup</h4>
                      <p>Restore your database from a previous backup file</p>
                    </div>
                  </div>
                  <div class="restore-controls">
                    <select id="backupSelect" class="restore-select">
                      <option value="">Select backup to restore...</option>
                    </select>
                    <button class="restore-btn" onclick="showRestoreConfirmation()" disabled>Restore Database</button>
                  </div>
                  <div class="restore-warning">
                    ‚ö†Ô∏è <strong>Warning:</strong> Restoring will replace all current data. A backup of current data will be created automatically before restoring.
                  </div>
                </div>
              </div>
              
              <!-- Auto Backup Info -->
              <div class="backup-section">
                <div class="backup-info-card">
                  <h4>Automatic Backups</h4>
                  <ul class="backup-features">
                    <li>‚úÖ Startup backup when server starts</li>
                    <li>‚úÖ Daily automatic backups</li>
                    <li>‚úÖ Keeps last 10 backups</li>
                    <li>‚úÖ Automatic cleanup of old backups</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          
          <!-- General Tab -->
          <div id="generalTab" class="settings-tab-content">
            <div class="settings-section">
              <h3>General Settings</h3>
              <p class="settings-description">Application preferences and configuration.</p>
              <div class="setting-item">
                <label>Company Name</label>
                <input type="text" value="KHS Construction" class="setting-input">
              </div>
              <div class="setting-item">
                <label>Default Customer Type</label>
                <select class="setting-input">
                  <option value="CURRENT">Current Customer</option>
                  <option value="LEADS">Lead</option>
                </select>
              </div>
              <p><em>More settings coming soon...</em></p>
            </div>
          </div>

          <!-- Text Send Tab -->
          <div id="textsendTab" class="settings-tab-content">
            <div class="settings-section">
              <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Text Send Contacts</h3>
                <button class="add-btn" onclick="showContactModal()" style="padding: 8px 16px;">+ Add Contact</button>
              </div>
              <p class="settings-description">Manage contacts who can receive customer information via text message. Use the "Share Info" button on customer cards to send info to selected contacts.</p>

              <!-- Contact Filter Tabs -->
              <div class="contact-filter-tabs" style="margin-bottom: 20px;">
                <button class="filter-tab active" data-type="all" onclick="filterContacts('all')">All Contacts</button>
                <button class="filter-tab" data-type="SUB" onclick="filterContacts('SUB')">Subs</button>
                <button class="filter-tab" data-type="WORKER" onclick="filterContacts('WORKER')">Workers</button>
                <button class="filter-tab" data-type="OTHER" onclick="filterContacts('OTHER')">Other</button>
              </div>

              <!-- Contacts List -->
              <div class="contact-list-wrapper">
                <table class="contact-table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Phone</th>
                      <th>Address</th>
                      <th>Type</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="contactsTableBody">
                    <tr class="loading-row"><td colspan="5">Loading contacts...</td></tr>
                  </tbody>
                </table>
              </div>

              <!-- Custom Notes Management -->
              <div class="textsend-section" style="margin-top: 30px; padding: 20px; background: #F9FAFB; border-radius: 8px;">
                <h4>Custom Notes</h4>
                <p style="margin-bottom: 15px; color: #6B7280;">Manage the dropdown list of custom notes for the Send Info feature:</p>
                <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                  <input type="text" id="newCustomNote" placeholder="Add new custom note..." style="flex: 1; padding: 8px; border: 1px solid #D1D5DB; border-radius: 4px;">
                  <button onclick="addCustomNote()" style="padding: 8px 16px; background: #10B981; color: white; border: none; border-radius: 4px; cursor: pointer;">Add Note</button>
                </div>
                <div id="customNotesList" style="display: flex; flex-wrap: wrap; gap: 8px;">
                  <!-- Custom notes will be displayed here -->
                </div>
              </div>

              <!-- Test Message Section -->
              <div class="textsend-section" style="margin-top: 30px; padding: 20px; background: #F9FAFB; border-radius: 8px;">
                <h4>Test Text Send</h4>
                <p style="margin-bottom: 15px; color: #6B7280;">Test the text send functionality with a sample customer:</p>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                  <select id="testCustomerSelect" style="padding: 8px; border: 1px solid #D1D5DB; border-radius: 4px; min-width: 200px;">
                    <option value="">Select a customer...</option>
                  </select>
                  <button class="test-btn" onclick="testTextSend()" style="padding: 8px 16px; background: #3B82F6; color: white; border: none; border-radius: 4px; cursor: pointer;">Send Test Message</button>
                </div>
                <div id="testMessageResult" style="margin-top: 10px; padding: 10px; border-radius: 4px; display: none;"></div>
              </div>
            </div>
          </div>
          
          <!-- About Tab -->
          <div id="aboutTab" class="settings-tab-content">
            <div class="settings-section">
              <h3>About KHS CRM</h3>
              <div class="about-info">
                <div class="about-item">
                  <strong>Version:</strong> 1.0.0
                </div>
                <div class="about-item">
                  <strong>Database:</strong> SQLite
                </div>
                <div class="about-item">
                  <strong>Features:</strong> Customer Management, Job Tracking, Calendar Scheduling, Data Backup
                </div>
                <div class="about-item">
                  <strong>Data Location:</strong> ./crm.db
                </div>
                <div class="about-item">
                  <strong>Backup Location:</strong> ./backups/
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="workers" class="page">
        <div class="page-container">
          <div class="page-header">
            <button class="back-btn" data-target="dashboard">‚Üê Dashboard</button>
            <h2>Workers</h2>
            <button class="add-btn" id="addWorkerBtn">+ Add Worker</button>
          </div>
          
          <!-- Team Members Grid -->
          <div class="team-members-section">
            <h3>Team Members</h3>
            <div id="teamMembersGrid" class="team-members-grid">
              <div class="team-members-loading">Loading team members...</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Worker Detail Modal -->
      <div id="workerDetailModal" class="modal worker-detail-modal">
        <div class="modal-content worker-detail-content">
          <div class="modal-header">
            <h3 id="workerDetailTitle">Worker Details</h3>
            <button class="close-btn">&times;</button>
          </div>
          
          <!-- Worker Detail Tabs -->
          <div class="worker-detail-tabs">
            <button class="worker-detail-tab active" data-tab="info">Info</button>
            <button class="worker-detail-tab" data-tab="hours">Hours</button>
            <button class="worker-detail-tab" data-tab="tasks">Tasks</button>
            <button class="worker-detail-tab" data-tab="notes">Notes</button>
          </div>
          
          <div class="worker-detail-content-wrapper">
            
            <!-- Info Tab -->
            <div id="workerInfoTab" class="worker-detail-tab-content active">
              <div class="worker-info-display">
                <div class="worker-info-header">
                  <div class="worker-avatar">
                    <div class="avatar-placeholder" id="workerAvatar">JD</div>
                  </div>
                  <div class="worker-basic-info">
                    <h4 id="workerDisplayName">John Doe</h4>
                    <span class="worker-role-badge" id="workerDisplayRole">Carpenter</span>
                    <div class="worker-status" id="workerDisplayStatus">Active</div>
                  </div>
                  <div class="worker-actions">
                    <button class="edit-worker-detail-btn" onclick="editWorkerFromDetail()">Edit Info</button>
                    <button class="set-login-btn" onclick="showSetLoginModal()">Set Login</button>
                  </div>
                </div>
                
                <div class="worker-info-details">
                  <div class="info-group">
                    <h5>Contact Information</h5>
                    <div class="info-item">
                      <span class="info-label">Phone:</span>
                      <span class="info-value" id="workerDisplayPhone">Not provided</span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">Email:</span>
                      <span class="info-value" id="workerDisplayEmail">Not provided</span>
                    </div>
                  </div>
                  
                  <div class="info-group" id="workerNotesGroup">
                    <h5>Notes</h5>
                    <div class="info-value" id="workerDisplayNotes">No notes available</div>
                  </div>
                  
                  <div class="info-group">
                    <h5>Work Statistics</h5>
                    <div class="stats-grid">
                      <div class="stat-item">
                        <span class="stat-value" id="workerTotalHours">0.0</span>
                        <span class="stat-label">Total Hours</span>
                      </div>
                      <div class="stat-item">
                        <span class="stat-value" id="workerTotalEntries">0</span>
                        <span class="stat-label">Time Entries</span>
                      </div>
                      <div class="stat-item">
                        <span class="stat-value" id="workerWeekHours">0.0</span>
                        <span class="stat-label">This Week</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Hours Tab -->
            <div id="workerHoursTab" class="worker-detail-tab-content">
              <div class="worker-hours-section">
                <div class="worker-hours-header">
                  <h4>Weekly Timesheet</h4>
                  <div class="week-navigation">
                    <button id="workerPrevWeek" class="week-nav-btn">‚Äπ</button>
                    <span id="workerCurrentWeek">Week of Sept 14, 2025</span>
                    <button id="workerNextWeek" class="week-nav-btn">‚Ä∫</button>
                    <button id="workerThisWeek" class="week-today-btn">This Week</button>
                  </div>
                  <div class="worker-hours-actions">
                    <button class="load-btn" id="loadWorkerHoursBtn">Load Hours</button>
                    <button class="save-btn" id="saveWorkerHoursBtn">Save Hours</button>
                  </div>
                </div>
                
                <!-- Weekly Timesheet Grid -->
                <div class="worker-timesheet-container">
                  <table class="timesheet-table" id="workerTimesheetTable">
                    <thead>
                      <tr>
                        <th class="day-column">Day</th>
                        <th class="time-column">Start Time</th>
                        <th class="time-column">End Time</th>
                        <th class="hours-column">Total Hours</th>
                        <th class="lunch-column">Lunch (mins)</th>
                        <th class="location-column">Job Location</th>
                        <th class="type-column">Work Type</th>
                        <th class="notes-column">Notes</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr data-day="monday">
                        <td class="day-header">Monday</td>
                        <td><input type="time" class="time-input start-time" data-day="monday"></td>
                        <td><input type="time" class="time-input end-time" data-day="monday"></td>
                        <td class="hours-cell"><input type="number" step="0.25" min="0" max="24" class="hours-input" readonly></td>
                        <td><input type="number" min="0" max="120" class="lunch-input" placeholder="0"></td>
                        <td><input type="text" class="location-input" placeholder="Job site/location"></td>
                        <td>
                          <select class="work-type-select">
                            <option value="">Select Type</option>
                            <option value="Framing">Framing</option>
                            <option value="Roofing">Roofing</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Plumbing">Plumbing</option>
                            <option value="Drywall">Drywall</option>
                            <option value="Flooring">Flooring</option>
                            <option value="Finish Carpentry">Finish Carpentry</option>
                            <option value="Site Prep">Site Prep</option>
                            <option value="General Labor">General Labor</option>
                            <option value="Other">Other</option>
                          </select>
                        </td>
                        <td><input type="text" class="notes-input" placeholder="Notes"></td>
                      </tr>
                      <tr data-day="tuesday">
                        <td class="day-header">Tuesday</td>
                        <td><input type="time" class="time-input start-time" data-day="tuesday"></td>
                        <td><input type="time" class="time-input end-time" data-day="tuesday"></td>
                        <td class="hours-cell"><input type="number" step="0.25" min="0" max="24" class="hours-input" readonly></td>
                        <td><input type="number" min="0" max="120" class="lunch-input" placeholder="0"></td>
                        <td><input type="text" class="location-input" placeholder="Job site/location"></td>
                        <td>
                          <select class="work-type-select">
                            <option value="">Select Type</option>
                            <option value="Framing">Framing</option>
                            <option value="Roofing">Roofing</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Plumbing">Plumbing</option>
                            <option value="Drywall">Drywall</option>
                            <option value="Flooring">Flooring</option>
                            <option value="Finish Carpentry">Finish Carpentry</option>
                            <option value="Site Prep">Site Prep</option>
                            <option value="General Labor">General Labor</option>
                            <option value="Other">Other</option>
                          </select>
                        </td>
                        <td><input type="text" class="notes-input" placeholder="Notes"></td>
                      </tr>
                      <tr data-day="wednesday">
                        <td class="day-header">Wednesday</td>
                        <td><input type="time" class="time-input start-time" data-day="wednesday"></td>
                        <td><input type="time" class="time-input end-time" data-day="wednesday"></td>
                        <td class="hours-cell"><input type="number" step="0.25" min="0" max="24" class="hours-input" readonly></td>
                        <td><input type="number" min="0" max="120" class="lunch-input" placeholder="0"></td>
                        <td><input type="text" class="location-input" placeholder="Job site/location"></td>
                        <td>
                          <select class="work-type-select">
                            <option value="">Select Type</option>
                            <option value="Framing">Framing</option>
                            <option value="Roofing">Roofing</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Plumbing">Plumbing</option>
                            <option value="Drywall">Drywall</option>
                            <option value="Flooring">Flooring</option>
                            <option value="Finish Carpentry">Finish Carpentry</option>
                            <option value="Site Prep">Site Prep</option>
                            <option value="General Labor">General Labor</option>
                            <option value="Other">Other</option>
                          </select>
                        </td>
                        <td><input type="text" class="notes-input" placeholder="Notes"></td>
                      </tr>
                      <tr data-day="thursday">
                        <td class="day-header">Thursday</td>
                        <td><input type="time" class="time-input start-time" data-day="thursday"></td>
                        <td><input type="time" class="time-input end-time" data-day="thursday"></td>
                        <td class="hours-cell"><input type="number" step="0.25" min="0" max="24" class="hours-input" readonly></td>
                        <td><input type="number" min="0" max="120" class="lunch-input" placeholder="0"></td>
                        <td><input type="text" class="location-input" placeholder="Job site/location"></td>
                        <td>
                          <select class="work-type-select">
                            <option value="">Select Type</option>
                            <option value="Framing">Framing</option>
                            <option value="Roofing">Roofing</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Plumbing">Plumbing</option>
                            <option value="Drywall">Drywall</option>
                            <option value="Flooring">Flooring</option>
                            <option value="Finish Carpentry">Finish Carpentry</option>
                            <option value="Site Prep">Site Prep</option>
                            <option value="General Labor">General Labor</option>
                            <option value="Other">Other</option>
                          </select>
                        </td>
                        <td><input type="text" class="notes-input" placeholder="Notes"></td>
                      </tr>
                      <tr data-day="friday">
                        <td class="day-header">Friday</td>
                        <td><input type="time" class="time-input start-time" data-day="friday"></td>
                        <td><input type="time" class="time-input end-time" data-day="friday"></td>
                        <td class="hours-cell"><input type="number" step="0.25" min="0" max="24" class="hours-input" readonly></td>
                        <td><input type="number" min="0" max="120" class="lunch-input" placeholder="0"></td>
                        <td><input type="text" class="location-input" placeholder="Job site/location"></td>
                        <td>
                          <select class="work-type-select">
                            <option value="">Select Type</option>
                            <option value="Framing">Framing</option>
                            <option value="Roofing">Roofing</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Plumbing">Plumbing</option>
                            <option value="Drywall">Drywall</option>
                            <option value="Flooring">Flooring</option>
                            <option value="Finish Carpentry">Finish Carpentry</option>
                            <option value="Site Prep">Site Prep</option>
                            <option value="General Labor">General Labor</option>
                            <option value="Other">Other</option>
                          </select>
                        </td>
                        <td><input type="text" class="notes-input" placeholder="Notes"></td>
                      </tr>
                      <tr data-day="saturday">
                        <td class="day-header">Saturday</td>
                        <td><input type="time" class="time-input start-time" data-day="saturday"></td>
                        <td><input type="time" class="time-input end-time" data-day="saturday"></td>
                        <td class="hours-cell"><input type="number" step="0.25" min="0" max="24" class="hours-input" readonly></td>
                        <td><input type="number" min="0" max="120" class="lunch-input" placeholder="0"></td>
                        <td><input type="text" class="location-input" placeholder="Job site/location"></td>
                        <td>
                          <select class="work-type-select">
                            <option value="">Select Type</option>
                            <option value="Framing">Framing</option>
                            <option value="Roofing">Roofing</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Plumbing">Plumbing</option>
                            <option value="Drywall">Drywall</option>
                            <option value="Flooring">Flooring</option>
                            <option value="Finish Carpentry">Finish Carpentry</option>
                            <option value="Site Prep">Site Prep</option>
                            <option value="General Labor">General Labor</option>
                            <option value="Other">Other</option>
                          </select>
                        </td>
                        <td><input type="text" class="notes-input" placeholder="Notes"></td>
                      </tr>
                      <tr data-day="sunday">
                        <td class="day-header">Sunday</td>
                        <td><input type="time" class="time-input start-time" data-day="sunday"></td>
                        <td><input type="time" class="time-input end-time" data-day="sunday"></td>
                        <td class="hours-cell"><input type="number" step="0.25" min="0" max="24" class="hours-input" readonly></td>
                        <td><input type="number" min="0" max="120" class="lunch-input" placeholder="0"></td>
                        <td><input type="text" class="location-input" placeholder="Job site/location"></td>
                        <td>
                          <select class="work-type-select">
                            <option value="">Select Type</option>
                            <option value="Framing">Framing</option>
                            <option value="Roofing">Roofing</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Plumbing">Plumbing</option>
                            <option value="Drywall">Drywall</option>
                            <option value="Flooring">Flooring</option>
                            <option value="Finish Carpentry">Finish Carpentry</option>
                            <option value="Site Prep">Site Prep</option>
                            <option value="General Labor">General Labor</option>
                            <option value="Other">Other</option>
                          </select>
                        </td>
                        <td><input type="text" class="notes-input" placeholder="Notes"></td>
                      </tr>
                    </tbody>
                    <tfoot>
                      <tr class="total-row">
                        <td><strong>TOTALS</strong></td>
                        <td colspan="2"></td>
                        <td class="total-hours"><strong id="workerTotalHoursWeek">0.00</strong></td>
                        <td class="total-lunch"><strong id="workerTotalLunchWeek">0</strong></td>
                        <td colspan="3"></td>
                      </tr>
                    </tfoot>
                  </table>
                  
                  <!-- Loading/Status Messages -->
                  <div id="workerHoursLoading" class="timesheet-loading" style="display: none;">
                    <div class="loading-message">Loading worker hours...</div>
                  </div>
                  <div id="workerHoursMessage" class="timesheet-message" style="display: none;"></div>
                </div>
              </div>
            </div>
            
            <!-- Tasks Tab -->
            <div id="workerTasksTab" class="worker-detail-tab-content">
              <div class="worker-tasks-section">
                <div class="worker-tasks-header">
                  <h4>Assigned Tasks</h4>
                  <button class="add-btn" id="addWorkerTaskBtn">+ Add Task</button>
                </div>
                
                <div class="tasks-filters">
                  <button class="task-filter active" data-filter="all">All Tasks</button>
                  <button class="task-filter" data-filter="pending">Pending</button>
                  <button class="task-filter" data-filter="completed">Completed</button>
                </div>
                
                <div id="workerTasksList" class="worker-tasks-list">
                  <div class="worker-tasks-loading">Loading tasks...</div>
                </div>
              </div>
            </div>
            
            <!-- Notes Tab -->
            <div id="workerNotesTab" class="worker-detail-tab-content">
              <div class="worker-notes-section">
                <div class="worker-notes-header">
                  <h4>Worker Notes</h4>
                  <button class="add-btn" id="addWorkerNoteBtn">+ Add Note</button>
                </div>
                
                <div class="note-categories">
                  <button class="note-category active" data-category="all">All Notes</button>
                  <button class="note-category" data-category="vacation">Vacation</button>
                  <button class="note-category" data-category="medical">Medical</button>
                  <button class="note-category" data-category="performance">Performance</button>
                  <button class="note-category" data-category="general">General</button>
                </div>
                
                <div id="workerNotesList" class="worker-notes-list">
                  <div class="worker-notes-loading">Loading notes...</div>
                </div>
              </div>
            </div>
            
          </div>
        </div>
      </div>
      
      <!-- Restore Confirmation Modal -->
      <div id="restoreModal" class="modal">
        <div class="modal-content restore-modal-content">
          <div class="modal-header">
            <h3>Confirm Database Restore</h3>
            <button class="close-btn">&times;</button>
          </div>
          <div class="restore-confirmation">
            <div class="restore-warning-icon">‚ö†Ô∏è</div>
            <div class="restore-message">
              <h4>Are you sure you want to restore from this backup?</h4>
              <p><strong>Selected backup:</strong> <span id="selectedBackupName">-</span></p>
              <p><strong>Backup date:</strong> <span id="selectedBackupDate">-</span></p>
              <div class="restore-effects">
                <h5>This will:</h5>
                <ul>
                  <li>‚úÖ Create a backup of your current data first</li>
                  <li>‚öôÔ∏è Replace all current customers, jobs, and schedule data</li>
                  <li>‚öôÔ∏è Replace all worker and time tracking data</li>
                  <li>üîÑ Restart the server automatically</li>
                </ul>
              </div>
              <div class="restore-recovery">
                <p><strong>Recovery:</strong> If you need to undo this restore, you can restore from the "pre-restore" backup that will be created.</p>
              </div>
            </div>
          </div>
          <div class="modal-actions">
            <button type="button" class="cancel-btn">Cancel</button>
            <button type="button" class="restore-confirm-btn" onclick="executeRestore()">Yes, Restore Database</button>
          </div>
        </div>
      </div>
      
      <!-- Add/Edit Worker Modal -->
      <div id="workerModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="workerModalTitle">Add Worker</h3>
            <button class="close-btn">&times;</button>
          </div>
          <form id="workerForm">
            <div class="form-group">
              <label for="workerInitials">Initials *</label>
              <input type="text" id="workerInitials" maxlength="3" placeholder="e.g., BH" required style="text-transform: uppercase;">
            </div>
            <div class="form-group">
              <label for="workerName">Name *</label>
              <input type="text" id="workerName" required>
            </div>
            <div class="form-group">
              <label>Role *</label>
              <div class="role-radio-group" style="display: flex; gap: 20px; margin-top: 8px;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                  <input type="radio" name="workerRole" value="Admin" required style="margin-right: 6px;">
                  Admin
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                  <input type="radio" name="workerRole" value="Supervisor" required style="margin-right: 6px;">
                  Supervisor
                </label>
              </div>
            </div>
            <div class="form-group">
              <label for="workerPhone">Phone</label>
              <input type="tel" id="workerPhone" placeholder="(808) 387-6129" maxlength="14">
            </div>
            <div class="form-group">
              <label for="workerEmail">Email</label>
              <input type="email" id="workerEmail">
            </div>
            <div class="form-group">
              <label for="workerNotes">Notes</label>
              <textarea id="workerNotes" placeholder="Additional notes about this worker..."></textarea>
            </div>
            <div class="modal-actions">
              <button type="button" class="cancel-btn">Cancel</button>
              <button type="submit" class="save-btn">Save Worker</button>
            </div>
          </form>
        </div>
      </div>
      
      <!-- Log Hours Modal -->
      <div id="hoursModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="hoursModalTitle">Log Work Hours</h3>
            <button class="close-btn">&times;</button>
          </div>
          <form id="hoursForm">
            <div class="form-group">
              <label for="hoursWorker">Worker *</label>
              <select id="hoursWorker" required>
                <option value="">Select worker...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="hoursJob">Job (Optional)</label>
              <select id="hoursJob">
                <option value="">Select job...</option>
              </select>
            </div>
            <div class="form-group">
              <label for="hoursDate">Date *</label>
              <input type="date" id="hoursDate" required>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="hoursStartTime">Start Time *</label>
                <input type="time" id="hoursStartTime" required>
              </div>
              <div class="form-group">
                <label for="hoursEndTime">End Time *</label>
                <input type="time" id="hoursEndTime" required>
              </div>
            </div>
            <div class="form-group">
              <label for="hoursBreakMinutes">Break Minutes</label>
              <input type="number" id="hoursBreakMinutes" min="0" value="0">
            </div>
            <div class="form-group">
              <label for="hoursWorkType">Work Type *</label>
              <select id="hoursWorkType" required>
                <option value="">Select work type...</option>
                <option value="Framing">Framing</option>
                <option value="Roofing">Roofing</option>
                <option value="Electrical">Electrical</option>
                <option value="Plumbing">Plumbing</option>
                <option value="Drywall">Drywall</option>
                <option value="Flooring">Flooring</option>
                <option value="Finish Carpentry">Finish Carpentry</option>
                <option value="Site Prep">Site Prep</option>
                <option value="General Labor">General Labor</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label for="hoursDescription">Description</label>
              <textarea id="hoursDescription" placeholder="Brief description of work performed..."></textarea>
            </div>
            <div class="modal-actions">
              <button type="button" class="cancel-btn">Cancel</button>
              <button type="submit" class="save-btn">Save Hours</button>
            </div>
          </form>
        </div>
      </div>

      <div id="materials" class="page">
        <div class="page-container">
          <div class="page-header">
            <button class="back-btn" data-target="dashboard">‚Üê Dashboard</button>
            <h2>Master Lists</h2>
          </div>
          
          <!-- List Toggle Controls -->
          <div class="master-lists-toggles">
            <label class="list-toggle-option">
              <input type="checkbox" id="toggleTasks" checked onchange="toggleMasterList('tasks', this.checked)">
              <span>üìã All Tasks</span>
            </label>
            <label class="list-toggle-option">
              <input type="checkbox" id="toggleTools" checked onchange="toggleMasterList('tools', this.checked)">
              <span>üîß All Tools</span>
            </label>
            <label class="list-toggle-option">
              <input type="checkbox" id="toggleMaterials" checked onchange="toggleMasterList('materials', this.checked)">
              <span>üì¶ All Materials</span>
            </label>
          </div>
          
          <div class="master-lists-container">
            <!-- Master Tasks List -->
            <div id="masterTasksSection" class="master-list-section">
              <div class="master-list-header">
                <h3>üìã All Tasks</h3>
                <div class="master-list-controls">
                  <button class="select-all-btn" onclick="selectAllJobs('tasks', true)" title="Select all jobs">
                    Select All
                  </button>
                  <button class="select-none-btn" onclick="selectAllJobs('tasks', false)" title="Deselect all jobs">
                    Select None
                  </button>
                  <button class="clear-master-list-btn" onclick="clearSelectedTasks()" title="Clear tasks from selected jobs">
                    <span>üóëÔ∏è</span> Clear Selected
                  </button>
                </div>
              </div>
              <div id="masterTasksList" class="master-list">
                <div class="loading">Loading tasks...</div>
              </div>
            </div>
            
            <!-- Master Tools List -->
            <div id="masterToolsSection" class="master-list-section">
              <div class="master-list-header">
                <h3>üîß All Tools</h3>
                <div class="master-list-controls">
                  <button class="select-all-btn" onclick="selectAllJobs('tools', true)" title="Select all jobs">
                    Select All
                  </button>
                  <button class="select-none-btn" onclick="selectAllJobs('tools', false)" title="Deselect all jobs">
                    Select None
                  </button>
                  <button class="clear-master-list-btn" onclick="clearSelectedTools()" title="Clear tools from selected jobs">
                    <span>üóëÔ∏è</span> Clear Selected
                  </button>
                </div>
              </div>
              <div id="masterToolsList" class="master-list">
                <div class="loading">Loading tools...</div>
              </div>
            </div>
            
            <!-- Master Materials List -->
            <div id="masterMaterialsSection" class="master-list-section">
              <div class="master-list-header">
                <h3>üì¶ All Materials</h3>
                <div class="master-list-controls">
                  <button class="select-all-btn" onclick="selectAllJobs('materials', true)" title="Select all jobs">
                    Select All
                  </button>
                  <button class="select-none-btn" onclick="selectAllJobs('materials', false)" title="Deselect all jobs">
                    Select None
                  </button>
                  <button class="clear-master-list-btn" onclick="clearSelectedMaterials()" title="Clear materials from selected jobs">
                    <span>üóëÔ∏è</span> Clear Selected
                  </button>
                </div>
              </div>
              <div id="masterMaterialsList" class="master-list">
                <div class="loading">Loading materials...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="profile" class="page">
        <div class="page-container">
          <div class="page-header">
            <button class="back-btn" data-target="dashboard">‚Üê Dashboard</button>
            <h2 id="displayName">Loading...</h2>
          </div>
          
          <!-- Profile Header Info -->
          <div class="profile-header-info">
            <p id="displayEmail">Loading...</p>
            <span id="displayRole">Loading...</span>
          </div>
          
          <!-- Profile Tabs -->
          <div class="profile-tabs">
            <button class="profile-tab active" data-tab="account">Account</button>
            <button class="profile-tab" data-tab="preferences">Preferences</button>
            <button class="profile-tab" data-tab="security">Security</button>
            <button class="profile-tab" data-tab="notifications">Notifications</button>
            <button class="profile-tab" data-tab="activity">Activity</button>
          </div>
          
          <!-- Account Tab -->
          <div id="accountTab" class="profile-tab-content active">
            <div class="profile-section">
              <div class="profile-header">
                <div class="profile-avatar">
                  <div class="avatar-placeholder" id="profileAvatar">A</div>
                </div>
                <div class="profile-basic-info">
                  <h3 id="profileDisplayName">Administrator</h3>
                  <span class="profile-role-badge" id="profileDisplayRole">Owner</span>
                  <div class="profile-member-since">
                    Member since <span id="profileMemberSince">January 2024</span>
                  </div>
                </div>
                <div class="profile-actions">
                  <button class="edit-profile-btn" onclick="editProfile()">Edit Profile</button>
                </div>
              </div>
              
              <div class="profile-details">
                <div class="detail-group">
                  <h4>Contact Information</h4>
                  <div class="detail-item">
                    <span class="detail-label">Name:</span>
                    <span class="detail-value" id="profileName">Administrator</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value" id="profileEmail">admin@khscrm.com</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Role:</span>
                    <span class="detail-value" id="profileRole">Owner</span>
                  </div>
                </div>
                
                <div class="detail-group">
                  <h4>Account Statistics</h4>
                  <div class="stats-grid">
                    <div class="stat-card">
                      <div class="stat-number" id="totalCustomers">0</div>
                      <div class="stat-label">Customers</div>
                    </div>
                    <div class="stat-card">
                      <div class="stat-number" id="totalJobs">0</div>
                      <div class="stat-label">Jobs</div>
                    </div>
                    <div class="stat-card">
                      <div class="stat-number" id="totalWorkers">0</div>
                      <div class="stat-label">Workers</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Preferences Tab -->
          <div id="preferencesTab" class="profile-tab-content">
            <div class="profile-section">
              <h3>Application Preferences</h3>
              
              <div class="preference-group">
                <h4>Dashboard Settings</h4>
                <div class="preference-item">
                  <label class="preference-label">
                    <input type="checkbox" id="showRecentJobs" checked>
                    <span class="checkbox-custom"></span>
                    Show recent jobs on dashboard
                  </label>
                </div>
                <div class="preference-item">
                  <label class="preference-label">
                    <input type="checkbox" id="showUpcomingEvents" checked>
                    <span class="checkbox-custom"></span>
                    Show upcoming events
                  </label>
                </div>
                <div class="preference-item">
                  <label for="defaultCustomerView">Default customer view:</label>
                  <select id="defaultCustomerView" class="preference-select">
                    <option value="all">All Customers</option>
                    <option value="CURRENT">Current Customers Only</option>
                    <option value="LEADS">Leads Only</option>
                  </select>
                </div>
              </div>
              
              <div class="preference-group">
                <h4>Display Settings</h4>
                <div class="preference-item">
                  <label for="themeSelect">Theme:</label>
                  <select id="themeSelect" class="preference-select">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="auto">Auto (System)</option>
                  </select>
                </div>
                <div class="preference-item">
                  <label for="dateFormat">Date format:</label>
                  <select id="dateFormat" class="preference-select">
                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                  </select>
                </div>
              </div>
              
              <div class="preference-actions">
                <button class="save-preferences-btn" onclick="savePreferences()">Save Preferences</button>
                <button class="reset-preferences-btn" onclick="resetPreferences()">Reset to Defaults</button>
              </div>
            </div>
          </div>
          
          <!-- Security Tab -->
          <div id="securityTab" class="profile-tab-content">
            <div class="profile-section">
              <h3>Security Settings</h3>
              
              <div class="security-group">
                <h4>Password</h4>
                <div class="security-item">
                  <div class="security-info">
                    <span class="security-label">Password last changed:</span>
                    <span class="security-value" id="passwordLastChanged">January 1, 2024</span>
                  </div>
                  <button class="change-password-btn" onclick="showChangePasswordModal()">Change Password</button>
                </div>
              </div>
              
              <div class="security-group">
                <h4>Login Security</h4>
                <div class="security-item">
                  <div class="security-info">
                    <span class="security-label">Last login:</span>
                    <span class="security-value" id="lastLogin">Today</span>
                  </div>
                </div>
              </div>
              
              <div class="security-group">
                <h4>Account Security</h4>
                <div class="security-item">
                  <div class="security-info">
                    <span class="security-label">Account status:</span>
                    <span class="security-value active">Active</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Notifications Tab -->
          <div id="notificationsTab" class="profile-tab-content">
            <div class="profile-section">
              <h3>Notification Preferences</h3>
              
              <div class="notification-group">
                <h4>Email Notifications</h4>
                <div class="notification-item">
                  <label class="notification-label">
                    <input type="checkbox" id="emailUpdates" checked>
                    <span class="checkbox-custom"></span>
                    <div class="notification-info">
                      <span class="notification-title">System Updates</span>
                      <span class="notification-desc">Receive emails about system updates and maintenance</span>
                    </div>
                  </label>
                </div>
                <div class="notification-item">
                  <label class="notification-label">
                    <input type="checkbox" id="jobReminders" checked>
                    <span class="checkbox-custom"></span>
                    <div class="notification-info">
                      <span class="notification-title">Job Reminders</span>
                      <span class="notification-desc">Get notified about upcoming job deadlines</span>
                    </div>
                  </label>
                </div>
                <div class="notification-item">
                  <label class="notification-label">
                    <input type="checkbox" id="backupNotifications" checked>
                    <span class="checkbox-custom"></span>
                    <div class="notification-info">
                      <span class="notification-title">Backup Notifications</span>
                      <span class="notification-desc">Receive confirmation when backups are completed</span>
                    </div>
                  </label>
                </div>
              </div>
              
              <div class="notification-group">
                <h4>System Alerts</h4>
                <div class="notification-item">
                  <label class="notification-label">
                    <input type="checkbox" id="systemAlerts" checked>
                    <span class="checkbox-custom"></span>
                    <div class="notification-info">
                      <span class="notification-title">Critical System Alerts</span>
                      <span class="notification-desc">Important system notifications and error alerts</span>
                    </div>
                  </label>
                </div>
                <div class="notification-item">
                  <label class="notification-label">
                    <input type="checkbox" id="securityAlerts" checked>
                    <span class="checkbox-custom"></span>
                    <div class="notification-info">
                      <span class="notification-title">Security Alerts</span>
                      <span class="notification-desc">Notifications about login attempts and security events</span>
                    </div>
                  </label>
                </div>
              </div>
              
              <div class="notification-actions">
                <button class="save-notifications-btn" onclick="saveNotificationPreferences()">Save Notification Settings</button>
              </div>
            </div>
          </div>
          
          <!-- Activity Tab -->
          <div id="activityTab" class="profile-tab-content">
            <div class="profile-section">
              <h3>Recent Activity</h3>
              
              <div class="activity-filter">
                <select id="activityFilter" class="activity-filter-select" onchange="filterActivity()">
                  <option value="all">All Activity</option>
                  <option value="login">Login Events</option>
                  <option value="customer">Customer Changes</option>
                  <option value="job">Job Changes</option>
                  <option value="system">System Events</option>
                </select>
              </div>
              
              <div class="activity-list" id="activityList">
                <div class="activity-loading">Loading activity...</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Edit Profile Modal -->
      <div id="editProfileModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Edit Profile</h3>
            <button class="close-btn" onclick="closeEditProfileModal()">&times;</button>
          </div>
          <form id="editProfileForm">
            <div class="form-group">
              <label for="editProfileName">Name *</label>
              <input type="text" id="editProfileName" required>
            </div>
            <div class="form-group">
              <label for="editProfileEmail">Email *</label>
              <input type="email" id="editProfileEmail" required>
            </div>
            <div class="modal-actions">
              <button type="button" class="cancel-btn" onclick="closeEditProfileModal()">Cancel</button>
              <button type="submit" class="save-btn">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
      
      <!-- Change Password Modal -->
      <div id="changePasswordModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Change Password</h3>
            <button class="close-btn" onclick="closeChangePasswordModal()">&times;</button>
          </div>
          <form id="changePasswordForm">
            <div class="form-group">
              <label for="currentPassword">Current Password *</label>
              <input type="password" id="currentPassword" required>
            </div>
            <div class="form-group">
              <label for="newPassword">New Password *</label>
              <input type="password" id="newPassword" required minlength="6">
              <small class="form-help">Password must be at least 6 characters long</small>
            </div>
            <div class="form-group">
              <label for="confirmPassword">Confirm New Password *</label>
              <input type="password" id="confirmPassword" required>
            </div>
            <div class="modal-actions">
              <button type="button" class="cancel-btn" onclick="closeChangePasswordModal()">Cancel</button>
              <button type="submit" class="save-btn">Change Password</button>
            </div>
          </form>
        </div>
      </div>
    </main>
  </div>

<!-- Contact Modal -->
  <div id="contactModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="contactModalTitle">Add Contact</h3>
        <button class="close-btn" onclick="closeModal('contactModal')">&times;</button>
      </div>
      <form id="contactForm">
        <div class="form-group">
          <label for="contactName">Name *</label>
          <input type="text" id="contactName" name="contactName" required>
        </div>
        <div class="form-group">
          <label for="contactPhone">Phone *</label>
          <input type="tel" id="contactPhone" name="contactPhone" placeholder="(808) 387-6129" maxlength="14" required>
        </div>
        <div class="form-group">
          <label for="contactAddress">Address</label>
          <input type="text" id="contactAddress" name="contactAddress">
        </div>
        <div class="form-group">
          <label>Contact Type *</label>
          <div class="contact-type-options" style="display: flex; gap: 15px; margin-top: 8px;">
            <label style="display: flex; align-items: center; cursor: pointer;">
              <input type="radio" name="contactType" value="SUB" required style="margin-right: 6px;">
              Sub
            </label>
            <label style="display: flex; align-items: center; cursor: pointer;">
              <input type="radio" name="contactType" value="WORKER" required style="margin-right: 6px;">
              Worker
            </label>
            <label style="display: flex; align-items: center; cursor: pointer;">
              <input type="radio" name="contactType" value="OTHER" required style="margin-right: 6px;">
              Other
            </label>
          </div>
        </div>
        <div class="form-group">
          <label for="contactNotes">Notes</label>
          <textarea id="contactNotes" name="contactNotes"></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="cancel-btn" onclick="closeModal('contactModal')">Cancel</button>
          <button type="submit" class="save-btn">Save Contact</button>
        </div>
      </form>
    </div>
  </div>

  <script src="config.js?v=20250919000000"></script>
  <script src="api-utils.js?v=20250919000001"></script>
  <script src="sw-register.js?v=20250919100000"></script>
  <script src="photo-compress.js?v=20250919102000"></script>
  <script src="exif-helper.js?v=20250919102000"></script>
  <script src="photo-upload-ui.js?v=20250919102000"></script>
  <!-- Set Worker Login Modal -->
  <div id="setLoginModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Set Worker Login Credentials</h3>
        <button class="close-btn" onclick="closeSetLoginModal()">&times;</button>
      </div>
      <form id="setLoginForm">
        <div class="form-group">
          <label for="loginUsername">Username *</label>
          <input type="text" id="loginUsername" name="username" required autocomplete="off">
          <small class="form-help">Choose a unique username for this worker</small>
        </div>
        <div class="form-group">
          <label for="loginPassword">Password *</label>
          <input type="password" id="loginPassword" name="password" required autocomplete="new-password">
          <small class="form-help">Minimum 6 characters recommended</small>
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="loginEnabled" name="loginEnabled" checked>
            <span class="checkbox-custom"></span>
            Enable login for this worker
          </label>
        </div>
        <div class="modal-actions">
          <button type="button" class="cancel-btn" onclick="closeSetLoginModal()">Cancel</button>
          <button type="submit" class="save-btn">Set Credentials</button>
        </div>
      </form>
    </div>
  </div>

  <script src="gantt-chart.js?v=20250919103000"></script>
  <script src="app.js?v=20250922000005"></script>
</body>
</html>
